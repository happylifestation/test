<script>
    function validateForm() {
        let isValid = true;
        let errorMessage = "";
        
        // Validate platform selection
        if ($('#platform').val() === "") {
            isValid = false;
            errorMessage += "\n- กรุณาเลือกช่องทางการสั่งซื้อ";
        }

        // Validate order number
        if ($('#orderNumber').val().trim() === "") {
            isValid = false;
            errorMessage += "\n- กรุณากรอกเลขออเดอร์";
        }

        // Validate customer name
        if ($('#cus_name').val().trim() === "") {
            isValid = false;
            errorMessage += "\n- กรุณากรอกชื่อลูกค้าในไลน์ @";
        }

        // Validate phone number (only numbers, at least 10 digits)
        let phone = $('#phone').val().trim();
        if (!/^\d{10,}$/.test(phone)) {
            isValid = false;
            errorMessage += "\n- กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง (ตัวเลข 10 หลักขึ้นไป)";
        }

        // Validate message details
        if ($('#detail').val().trim() === "") {
            isValid = false;
            errorMessage += "\n- กรุณากรอกข้อความที่ต้องการใส่บนงาน";
        }
        
        // Validate image upload
        let files = $('#temp-imgs')[0].files;
        if (files.length === 0) {
            isValid = false;
            errorMessage += "\n- กรุณาอัปโหลดรูปภาพ";
        } else if (files.length > 8) {
            isValid = false;
            errorMessage += "\n- สามารถอัปโหลดได้สูงสุด 8 รูป";
        } else {
            for (let file of files) {
                if (!['image/jpeg', 'image/png', 'image/jpg'].includes(file.type)) {
                    isValid = false;
                    errorMessage += "\n- อัปโหลดได้เฉพาะไฟล์รูปภาพ JPEG หรือ PNG";
                    break;
                }
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    isValid = false;
                    errorMessage += "\n- ไฟล์ " + file.name + " ขนาดใหญ่เกินไป (จำกัด 5MB)";
                    break;
                }
            }
        }

        if (!isValid) {
            Swal.fire({
                icon: 'error',
                title: 'ข้อผิดพลาด',
                text: errorMessage,
                customClass: {
                    icon: 'text-danger',
                    title: 'text-danger',
                    content: 'text-dark',
                    popup: 'rounded-4'
                },
                confirmButtonText: 'ปิด',
                allowOutsideClick: false,
                allowEscapeKey: false,
                allowEnterKey: false,
            });
        }
        return isValid;
    }

    (function () {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    event.preventDefault();
                    if (!validateForm()) {
                        event.stopPropagation();
                    } else {
                        submit();
                    }
                }, false);
            });
    })();
</script>
